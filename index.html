<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Velvet Oracle — Antichambre</title>

    <style>
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --velvet-black: #050505;
            --card-bg: #101010;
            --velvet-gold: #c8a96a;
            --velvet-gold-soft: #e4c98c;
            --amber-soft: #d9b677;
            --text-main: #f5f2e8;
            --text-muted: rgba(245, 242, 232, 0.72);
            --card-border: rgba(200, 169, 106, 0.45);
            --option-bg: #151515;
            --option-border: rgba(255, 255, 255, 0.05);
        }

        body {
            background: radial-gradient(circle at top, #181818 0, #050505 52%, #000 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px 14px;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text",
                system-ui, -webkit-system-font, "Segoe UI", Roboto, sans-serif;
            color: var(--text-main);
        }

        .frame {
            width: 100%;
            max-width: 480px;
            animation: fadeIn 0.6s ease-out;
        }

        .hidden {
            display: none !important;
        }

        .logo {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 18px;
        }

        .logo img {
            max-width: 180px;
            opacity: 0.97;
            filter: drop-shadow(0 4px 14px rgba(0, 0, 0, 0.7));
        }

        /* ===========================
           ANTICHAMBRE
        ============================ */

        .badge {
            font-size: 11px;
            letter-spacing: 0.35em;
            text-transform: uppercase;
            color: var(--text-muted);
            opacity: 0.7;
            margin-bottom: 18px;
            text-align: center;
        }

        .card {
            width: 100%;
            background: linear-gradient(145deg, #0a0a0a, #121212);
            border-radius: 20px;
            border: 1px solid var(--card-border);
            box-shadow:
                0 24px 60px rgba(0, 0, 0, 0.9),
                0 0 0 1px rgba(255, 255, 255, 0.02);
            padding: 26px 22px 24px;
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .title {
            font-size: 23px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-bottom: 6px;
        }

        .subtitle {
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.24em;
            color: var(--text-muted);
            margin-bottom: 18px;
        }

        .divider {
            width: 40px;
            height: 1px;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(200, 169, 106, 0.9),
                transparent
            );
            margin: 0 auto 18px auto;
        }

        .body-text {
            font-size: 15px;
            line-height: 1.75;
            color: var(--text-muted);
            margin-bottom: 20px;
        }

        .body-text span {
            color: var(--velvet-gold-soft);
        }

        .footer-text {
            font-size: 13px;
            line-height: 1.7;
            color: rgba(245, 242, 232, 0.7);
            margin-bottom: 20px;
        }

        .note {
            font-size: 11px;
            text-align: center;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            color: rgba(245, 242, 232, 0.55);
            margin-bottom: 10px;
        }

        .cta {
            width: 100%;
            border-radius: 999px;
            border: none;
            outline: none;
            padding: 14px 18px;
            font-size: 15px;
            font-weight: 500;
            letter-spacing: 0.14em;
            text-transform: uppercase;
            background: linear-gradient(
                135deg,
                var(--velvet-gold),
                var(--velvet-gold-soft)
            );
            color: #000;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-shadow:
                0 18px 40px rgba(0, 0, 0, 0.9),
                0 0 0 1px rgba(0, 0, 0, 0.6);
            margin: 0 auto;
            transform: translateY(0);
            transition: transform 0.16s ease-out, box-shadow 0.16s ease-out,
                        filter 0.16s ease-out;
        }

        .cta:active {
            transform: translateY(1px);
            box-shadow:
                0 10px 26px rgba(0, 0, 0, 0.9),
                0 0 0 1px rgba(0, 0, 0, 0.7);
            filter: brightness(0.96);
        }

        .under-card {
            margin-top: 14px;
            font-size: 11px;
            text-align: center;
            color: rgba(245, 242, 232, 0.45);
        }

        /* ===========================
           CHAMBRE SOMBRE
        ============================ */

        .chamber {
            width: 100%;
            background: radial-gradient(circle at top, #0b0b0b 0, #020202 60%, #000 100%);
            border-radius: 22px;
            border: 1px solid rgba(200, 169, 106, 0.35);
            box-shadow:
                0 26px 70px rgba(0, 0, 0, 0.95),
                0 0 0 1px rgba(255, 255, 255, 0.02);
            padding: 26px 22px 26px;
            text-align: center;
        }

        .chamber-heading {
            font-size: 11px;
            letter-spacing: 0.28em;
            text-transform: uppercase;
            color: rgba(245, 242, 232, 0.6);
            margin-bottom: 14px;
        }

        .chamber-title {
            font-size: 19px;
            text-transform: uppercase;
            letter-spacing: 0.18em;
            color: var(--velvet-gold-soft);
            margin-bottom: 12px;
        }

        .chamber-line {
            width: 56px;
            height: 1px;
            background: linear-gradient(
                90deg,
                rgba(200, 169, 106, 0),
                rgba(200, 169, 106, 0.9),
                rgba(200, 169, 106, 0)
            );
            margin: 0 auto 18px auto;
        }

        .chamber-text {
            font-size: 15px;
            line-height: 1.75;
            color: rgba(245, 242, 232, 0.78);
            margin-bottom: 26px;
        }

        .chamber-text span {
            color: var(--velvet-gold-soft);
        }

        .chamber-cta {
            width: 100%;
            border-radius: 999px;
            border: 1px solid rgba(200,169,106,0.4);
            padding: 13px 18px;
            background: #111111;
            color: var(--velvet-gold-soft);
            letter-spacing: 0.16em;
            text-transform: uppercase;
            font-size: 13px;
            cursor: pointer;
        }

        /* ===========================
           PLAYER QUESTION
        ============================ */

        .quiz-card {
            width: 100%;
            background: radial-gradient(circle at top, #151515 0, #050505 55%, #000 100%);
            border-radius: 24px;
            border: 1px solid rgba(200,169,106,0.38);
            box-shadow:
                0 30px 80px rgba(0,0,0,0.96),
                0 0 0 1px rgba(255,255,255,0.02);
            padding: 22px 18px 18px;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .quiz-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 4px;
        }

        .quiz-logo-small img {
            width: 110px;
            opacity: 0.9;
        }

        .quiz-progress {
            padding: 7px 12px;
            border-radius: 999px;
            border: 1px solid rgba(200,169,106,0.45);
            font-size: 11px;
            letter-spacing: 0.16em;
            text-transform: uppercase;
            color: rgba(245,242,232,0.85);
            white-space: nowrap;
        }

        .quiz-progress span {
            color: var(--velvet-gold-soft);
        }

        .quiz-main {
            padding: 10px 4px 2px;
        }

        .quiz-label {
            font-size: 12px;
            letter-spacing: 0.26em;
            text-transform: uppercase;
            color: rgba(245,242,232,0.6);
            margin-bottom: 10px;
        }

        .quiz-question {
            font-size: 19px;
            line-height: 1.8;
            color: var(--text-main);
        }

        .quiz-meta {
            font-size: 12px;
            letter-spacing: 0.22em;
            text-transform: uppercase;
            color: rgba(245,242,232,0.5);
            margin-top: 14px;
        }

        .quiz-explanation {
            margin-top: 16px;
            padding: 14px 14px 12px;
            border-radius: 18px;
            background: linear-gradient(180deg, #111111, #070707);
            border: 1px solid rgba(200,169,106,0.22);
            box-shadow:
                0 16px 40px rgba(0,0,0,0.85),
                0 0 0 1px rgba(0,0,0,0.6);
            font-size: 13px;
            line-height: 1.65;
            color: rgba(228,201,140,0.92);
            font-style: italic;
        }

        .quiz-explanation-line {
            margin-bottom: 4px;
        }

        .quiz-explanation-line strong {
            font-style: normal;
        }

        .ex-label {
            text-transform: uppercase;
            letter-spacing: 0.16em;
            font-size: 10px;
            color: rgba(245,242,232,0.55);
            display: block;
            margin-bottom: 4px;
        }

        .ex-user span.letter {
            color: var(--velvet-gold-soft);
            font-weight: 600;
        }

        .ex-user span.text {
            color: #f5f2e8;
        }

        .ex-correct span.letter {
            color: #f2da9b;
            font-weight: 600;
        }

        .ex-correct span.text {
            color: rgba(228,201,140,0.96);
        }

        .ex-orion {
            margin-top: 8px;
            color: var(--amber-soft);
        }

        .quiz-options {
            margin-top: 12px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .quiz-option {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            padding: 18px 18px;
            background: var(--option-bg);
            border-radius: 999px;
            border: 1px solid var(--option-border);
            color: rgba(245,242,232,0.94);
            font-size: 17px;
            cursor: pointer;
            transition: background 0.16s ease-out, transform 0.12s ease-out,
                        border-color 0.16s ease-out, box-shadow 0.16s ease-out;
        }

        .quiz-option-letter {
            width: 34px;
            height: 34px;
            border-radius: 999px;
            border: 2px solid rgba(200,169,106,0.75);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            color: var(--velvet-gold-soft);
            flex-shrink: 0;
        }

        .quiz-option-text {
            flex: 1;
            text-align: left;
            font-size: 16px;
            line-height: 1.5;
        }

        .quiz-option:active {
            transform: translateY(1px);
        }

        .quiz-option.selected {
            background: radial-gradient(circle at top, #22160b 0, #15100a 60%, #060606 100%);
            border-color: rgba(200,169,106,0.95);
            box-shadow: 0 0 0 1px rgba(200,169,106,0.5);
        }

        .quiz-option.disabled {
            opacity: 0.6;
            cursor: default;
            pointer-events: none;
        }

        .quiz-footer {
            display: flex;
            justify-content: space-between;
           	align-items: center;
            margin-top: 10px;
            font-size: 12px;
            color: rgba(245,242,232,0.58);
        }

        .quiz-timer,
        .quiz-step {
            letter-spacing: 0.2em;
            text-transform: uppercase;
        }

        .quiz-actions {
            margin-top: 12px;
            display: flex;
            justify-content: flex-end;
        }

        .quiz-next {
            border-radius: 999px;
            border: none;
            padding: 10px 18px;
            background: linear-gradient(135deg, var(--velvet-gold), var(--velvet-gold-soft));
            color: #000;
            font-size: 13px;
            letter-spacing: 0.16em;
            text-transform: uppercase;
            font-weight: 500;
            cursor: pointer;
            box-shadow:
                0 14px 30px rgba(0,0,0,0.9),
                0 0 0 1px rgba(0,0,0,0.7);
            opacity: 0.85;
            transition: opacity 0.15s ease-out, transform 0.12s ease-out;
        }

        .quiz-next:disabled {
            opacity: 0.35;
            box-shadow: none;
            cursor: default;
        }

        .quiz-next:not(:disabled):active {
            transform: translateY(1px);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (min-width: 520px) {
            .card,
            .chamber,
            .quiz-card {
                padding: 26px 24px 26px;
            }
        }
    </style>
</head>

<body>

<div class="frame">

    <!-- ANTICHAMBRE -->
    <div class="screen-intro">
        <div class="badge">Velvet Oracle — Antichambre</div>

        <div class="card">
            <div class="logo">
                <img src="velvet-logo.svg" alt="Velvet Élite — Velvet Oracle">
            </div>

            <div class="title">Velvet Oracle</div>
            <div class="subtitle">Examen d’entrée privé</div>

            <div class="divider"></div>

            <p class="body-text">
                Ce n’est pas un quiz.  
                C’est une <span>épreuve silencieuse</span>.
            </p>

            <p class="footer-text">
                Une seule fois. Aucun bruit.  
                Juste toi, ton calme intérieur.
            </p>

            <p class="note">Quand tu te sentiras prêt</p>

            <button class="cta" id="btn-ready">
                Je suis prêt ●
            </button>
        </div>

        <div class="under-card">© Velvet Élite — Edition Oracle.</div>
    </div>


    <!-- CHAMBRE SOMBRE -->
    <div class="screen-chamber hidden">
        <div class="chamber">

            <div class="logo">
                <img src="velvet-logo.svg" alt="Velvet Élite — Logo">
            </div>

            <div class="chamber-heading">Velvet Oracle — Chambre</div>

            <div class="chamber-title">Silence intérieur</div>
            <div class="chamber-line"></div>

            <p class="chamber-text">
                Ici, rien ne se joue sur la chance.  
                Chaque réponse révèle ce que tu maîtrises vraiment.
                <br><br>
                Quand tu continues, le <span>temps commence à courir</span>.
            </p>

            <button class="chamber-cta" id="btn-start-exam">
                ● Commencer l’épreuve
            </button>

        </div>
    </div>


    <!-- PLAYER — QUESTIONS -->
    <div class="screen-quiz hidden">
        <div class="quiz-card">

            <div class="quiz-header">
                <div class="quiz-logo-small">
                    <img src="velvet-logo.svg" alt="Velvet Oracle">
                </div>
                <div class="quiz-progress">
                    Q <span id="quiz-index">1</span> / <span id="quiz-total">15</span>
                </div>
            </div>

            <div class="quiz-main">
                <div class="quiz-label" id="quiz-label">Examen — Série d’entrée</div>
                <div class="quiz-question" id="quiz-question"></div>
                <div class="quiz-meta" id="quiz-meta"></div>
                <div class="quiz-explanation hidden" id="quiz-explanation"></div>
            </div>

            <div class="quiz-options">
                <button class="quiz-option" data-index="0">
                    <div class="quiz-option-letter">A</div>
                    <div class="quiz-option-text" id="opt-0"></div>
                </button>
                <button class="quiz-option" data-index="1">
                    <div class="quiz-option-letter">B</div>
                    <div class="quiz-option-text" id="opt-1"></div>
                </button>
                <button class="quiz-option" data-index="2">
                    <div class="quiz-option-letter">C</div>
                    <div class="quiz-option-text" id="opt-2"></div>
                </button>
                <button class="quiz-option" data-index="3">
                    <div class="quiz-option-letter">D</div>
                    <div class="quiz-option-text" id="opt-3"></div>
                </button>
            </div>

            <div class="quiz-footer">
                <div class="quiz-timer" id="quiz-timer">Temps · 00:20</div>
                <div class="quiz-step" id="quiz-step">Étape 1 / 15</div>
            </div>

            <div class="quiz-actions">
                <button class="quiz-next" id="btn-next" disabled>
                    Valider la réponse
                </button>
            </div>

        </div>
    </div>

</div>

<script>
/**
 * Données des 15 questions issues de exam_questions.py
 */
const QUIZ_DATA = [
    {
        id: 1,
        domain: "Musique",
        level: 4,
        question: "Dans l’effervescence baroque italienne, quel maître fixe vraiment la grammaire du concerto moderne ?",
        options: [
            "Arcangelo Corelli",
            "Antonio Vivaldi",
            "Giuseppe Torelli",
            "Tomaso Albinoni"
        ],
        correct_index: 1,
        explanation: `Vivaldi ne fait pas qu’écrire une multitude de concertos : il en fixe la grammaire.
La forme en trois mouvements (rapide–lent–rapide), le dialogue structuré entre soliste et orchestre
et la virtuosité assumée deviennent, avec lui, un langage stable que Bach lui-même étudiera et transposera.
Corelli ou Torelli préparent le terrain, mais c’est Vivaldi qui impose vraiment le standard du concerto moderne.`
    },
    {
        id: 2,
        domain: "Musique",
        level: 4,
        question: "Dans l’univers lusophone, quel chant mêle saudade, douleur retenue et mélodie modale ?",
        options: [
            "Morna",
            "Flamenco",
            "Fado",
            "Kizomba"
        ],
        correct_index: 2,
        explanation: `Le fado naît dans les quartiers populaires de Lisbonne et cristallise la saudade portugaise :
une nostalgie profonde, teintée de manque et de fatalisme élégant. La morna cap-verdienne porte aussi
une mélancolie, mais dans un autre contexte culturel ; le flamenco est plus brûlant et percussif,
la kizomba plus dansante. C’est le fado qui incarne le mieux cette douleur retenue, soutenue par des lignes
mélodiques souvent modales.`
    },
    {
        id: 3,
        domain: "Musique",
        level: 5,
        question: "Quelle figure russe transforme l’oppression d’un peuple en une Cinquième symphonie d’une âpreté saisissante ?",
        options: [
            "Sergueï Rachmaninov",
            "Dmitri Chostakovitch",
            "Sergueï Prokofiev",
            "Piotr Ilitch Tchaïkovski"
        ],
        correct_index: 1,
        explanation: `La Cinquième symphonie de Chostakovitch (1937) est écrite sous le regard pesant du régime stalinien,
après une mise au ban officielle. En surface, l’œuvre semble répondre aux exigences du réalisme socialiste ;
en profondeur, elle laisse filtrer une tension, une ironie tragique et une âpreté qui ont souvent été lues
comme le reflet de l’oppression subie par tout un peuple. Rachmaninov et Prokofiev portent d’autres drames,
mais aucun ne condense cette ambivalence politique et émotionnelle avec une telle densité.`
    },
    {
        id: 4,
        domain: "Science",
        level: 4,
        question: "En physique moderne, quelle constante fixe la vitesse ultime permise à toute information ?",
        options: [
            "La constante de Planck",
            "La vitesse de la lumière",
            "La constante gravitationnelle",
            "La charge élémentaire"
        ],
        correct_index: 1,
        explanation: `Dans la relativité restreinte d’Einstein, la vitesse de la lumière dans le vide, notée c, est bien plus
qu’un simple chiffre : elle définit la limite absolue de propagation de l’information et de toute interaction causale.
La constante de Planck structure le monde quantique, la constante gravitationnelle règle l’intensité de la gravitation,
et la charge élémentaire celle de l’électron ; mais c’est c qui borne la vitesse de tout signal physique.`
    },
    {
        id: 5,
        domain: "Science",
        level: 4,
        question: "Quel savant du XVIIᵉ siècle établit la mécanique fondatrice qui gouverne le mouvement ?",
        options: [
            "Galilée",
            "Isaac Newton",
            "Johannes Kepler",
            "René Descartes"
        ],
        correct_index: 1,
        explanation: `Newton formalise la mécanique classique avec ses trois lois du mouvement et la loi de la gravitation universelle.
Là où Galilée et Kepler ont produit des observations et des lois partielles (chute des corps, orbites planétaires),
Newton unifie ces phénomènes dans un cadre mathématique cohérent qui s’applique aussi bien à une pomme qu’aux planètes.
Cette synthèse fera de sa mécanique la référence pendant plus de deux siècles.`
    },
    {
        id: 6,
        domain: "Science",
        level: 5,
        question: "Parmi les particules du monde ordinaire, laquelle porte la charge négative qui structure la matière ?",
        options: [
            "Le neutrino",
            "Le muon",
            "L’électron",
            "Le quark down"
        ],
        correct_index: 2,
        explanation: `Dans les atomes ordinaires, ce sont les électrons qui portent la charge négative et organisent la chimie :
leurs configurations autour du noyau déterminent les liaisons et les propriétés des éléments.
Neutrinos et muons sont aussi des leptons mais n’interviennent pas dans la structure chimique de la matière courante,
tandis que les quarks down restent confinés à l’intérieur des protons et neutrons. L’électron est donc la pièce maîtresse
de la charge négative à notre échelle.`
    },
    {
        id: 7,
        domain: "Civilisations/Mythologies",
        level: 4,
        question: "Dans le panthéon égyptien, quelle divinité au visage de faucon incarne la lumière victorieuse ?",
        options: [
            "Rê",
            "Horus",
            "Sobek",
            "Seth"
        ],
        correct_index: 1,
        explanation: `Horus, souvent représenté avec une tête de faucon, est le dieu de la royauté légitime et de la lumière victorieuse.
Fils d’Isis et d’Osiris, il triomphe de Seth dans les récits où il venge son père et rétablit l’ordre.
Rê incarne le soleil lui-même, Sobek les forces du Nil et de la sauvagerie, Seth le chaos et la violence.
Horus symbolise la lumière qui gagne et la continuité du pouvoir pharaonique.`
    },
    {
        id: 8,
        domain: "Civilisations/Mythologies",
        level: 4,
        question: "Quel peuple marchand développe un alphabet consonantique qui influencera directement l’alphabet grec ?",
        options: [
            "Les Phéniciens",
            "Les Assyriens",
            "Les Hittites",
            "Les Araméens"
        ],
        correct_index: 0,
        explanation: `Les Phéniciens, grands navigateurs et commerçants du Levant, mettent au point un alphabet principalement
consonantique, simple à tracer et à diffuser, parfaitement adapté aux échanges marchands.
Les Grecs reprendront cette structure en y ajoutant des voyelles notées explicitement, faisant naître
l’un des ancêtres directs de nos alphabets occidentaux. Assyriens, Hittites et Araméens ont leurs systèmes,
mais l’impact structurant sur l’alphabet grec vient du modèle phénicien.`
    },
    {
        id: 9,
        domain: "Civilisations/Mythologies",
        level: 5,
        question: "Dans les récits anciens, quel roi errant élève la ruse au rang d’art souverain pour défier son destin ?",
        options: [
            "Jason",
            "Thésée",
            "Ulysse",
            "Énée"
        ],
        correct_index: 2,
        explanation: `Ulysse, héros de l’Odyssée, n’est ni le plus fort ni le plus pieux, mais il excelle dans la ruse et la stratégie :
du cheval de Troie aux déguisements de son retour à Ithaque, il contourne sans cesse un destin hostile.
Jason et Thésée vivent aussi des quêtes, Énée porte le projet fondateur de Rome, mais aucun ne fait de l’intelligence
tactique un art aussi central que le fait Ulysse.`
    },
    {
        id: 10,
        domain: "Psychologie",
        level: 4,
        question: "Quel biais pousse l’esprit à ne retenir que ce qui renforce ses convictions préalables ?",
        options: [
            "Le biais de confirmation",
            "Le biais de disponibilité",
            "Le biais d’ancrage",
            "L’effet de halo"
        ],
        correct_index: 0,
        explanation: `Le biais de confirmation incite l’esprit à chercher, sélectionner et mémoriser en priorité les informations
qui vont dans le sens de ses croyances préexistantes, tout en minimisant celles qui les contredisent.
La disponibilité concerne la facilité avec laquelle un exemple nous vient à l’esprit, l’ancrage la première valeur
qui sert de référence, et l’effet de halo la tendance à généraliser une impression positive ou négative.
Ici, c’est bien la mécanique de renforcement des convictions qui est au centre.`
    },
    {
        id: 11,
        domain: "Psychologie",
        level: 4,
        question: "Dans la pyramide de Maslow, quel besoin s’impose juste après les nécessités vitales ?",
        options: [
            "Les besoins sociaux",
            "Les besoins de sécurité",
            "Les besoins d’estime",
            "Les besoins d’accomplissement"
        ],
        correct_index: 1,
        explanation: `Dans le modèle de Maslow, on commence par les besoins physiologiques (respirer, boire, manger, dormir).
Une fois ce socle assuré, viennent les besoins de sécurité : stabilité, protection, environnement prévisible.
Les besoins sociaux, d’estime puis d’accomplissement n’arrivent qu’ensuite, quand les fondations physique
et sécuritaire sont suffisamment satisfaites.`
    },
    {
        id: 12,
        domain: "Psychologie",
        level: 5,
        question: "Quel mécanisme décrit l’inconfort né de deux vérités incompatibles que l’on tente malgré tout de réconcilier ?",
        options: [
            "La réactance",
            "La dissonance cognitive",
            "La sublimation",
            "La rationalisation"
        ],
        correct_index: 1,
        explanation: `La dissonance cognitive désigne la tension interne ressentie quand nos croyances, nos actes ou nos informations
se contredisent. Pour réduire cet inconfort, nous modifions parfois nos pensées ou réinterprétons la réalité.
La réactance est une résistance à la contrainte, la sublimation un redéploiement des pulsions vers des buts socialement
valorisés, et la rationalisation une justification a posteriori. La dissonance, elle, cible le conflit entre deux vérités
que l’on tente de maintenir ensemble.`
    },
    {
        id: 13,
        domain: "Technologie",
        level: 4,
        question: "Quel pionnier de l’informatique conceptualise la machine universelle ?",
        options: [
            "Ada Lovelace",
            "Alan Turing",
            "Claude Shannon",
            "John von Neumann"
        ],
        correct_index: 1,
        explanation: `Alan Turing formalise dans les années 1930 l’idée de machine universelle : un dispositif abstrait capable de simuler
tout autre calcul formellement définissable. Ada Lovelace a l’intuition du programme, Shannon relie logique et circuits électriques,
von Neumann propose une architecture pratique pour les ordinateurs. Mais la notion de machine universelle, fondement théorique
de l’informatique, est bien attribuée à Turing.`
    },
    {
        id: 14,
        domain: "Technologie",
        level: 4,
        question: "Quel protocole assure la discrétion des échanges web grâce à une couche de chiffrement dédiée ?",
        options: [
            "HTTP",
            "TLS",
            "HTTPS",
            "SSL"
        ],
        correct_index: 2,
        explanation: `HTTPS n’est pas un nouveau langage, mais la version sécurisée de HTTP encapsulée dans une couche de chiffrement
(aujourd’hui principalement TLS). En pratique, c’est bien “https://” dans le navigateur qui garantit au visiteur un canal chiffré
entre son client et le serveur. TLS est le protocole cryptographique sous-jacent, SSL son ancêtre, HTTP la version non chiffrée.
Pour la discrétion des échanges web telle que l’utilisateur la perçoit, c’est donc HTTPS qui est la bonne réponse.`
    },
    {
        id: 15,
        domain: "Technologie",
        level: 5,
        question: "Quel modèle d’apprentissage s’affine en superposant des couches successives de représentation ?",
        options: [
            "Un réseau convolutionnel (CNN)",
            "Un réseau récurrent (RNN)",
            "Un réseau profond (Deep Learning)",
            "Un réseau génératif (GAN)"
        ],
        correct_index: 2,
        explanation: `Le terme de réseau profond renvoie précisément à l’idée de multiplier les couches de neurones afin que le modèle
apprenne des représentations de plus en plus abstraites des données brutes. Les CNN et RNN sont des architectures particulières
qui peuvent être profondes, les GAN combinent un générateur et un discriminateur, mais c’est bien le deep learning — la profondeur
des couches — qui décrit l’affinement progressif des représentations.`
    }
];

const TOTAL_QUESTIONS = QUIZ_DATA.length;
const LETTERS = ["A", "B", "C", "D"];

// Détection Telegram WebApp
const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
if (tg && typeof tg.ready === "function") {
    tg.ready();
}

let currentIndex = 0;
let currentSelection = null;
let answers = [];
let showingExplanation = false;

let questionTimer = null;
let questionRemaining = 20;
let examStartTime = null;

/* Navigation des écrans */
const screenIntro = document.querySelector(".screen-intro");
const screenChamber = document.querySelector(".screen-chamber");
const screenQuiz = document.querySelector(".screen-quiz");

document.getElementById("btn-ready").addEventListener("click", () => {
    screenIntro.classList.add("hidden");
    screenChamber.classList.remove("hidden");
});

document.getElementById("btn-start-exam").addEventListener("click", () => {
    screenChamber.classList.add("hidden");
    screenQuiz.classList.remove("hidden");
    startQuiz();
});

/* Éléments du player */
const quizIndexEl = document.getElementById("quiz-index");
const quizTotalEl = document.getElementById("quiz-total");
const quizQuestionEl = document.getElementById("quiz-question");
const quizMetaEl = document.getElementById("quiz-meta");
const quizTimerEl = document.getElementById("quiz-timer");
const quizStepEl = document.getElementById("quiz-step");
const quizExplanationEl = document.getElementById("quiz-explanation");
const optionButtons = document.querySelectorAll(".quiz-option");
const btnNext = document.getElementById("btn-next");

quizTotalEl.textContent = TOTAL_QUESTIONS.toString();

/* Timer helpers */
function formatSeconds(sec) {
    const s = Math.max(0, sec);
    const minutes = Math.floor(s / 60);
    const seconds = s % 60;
    return `${String(minutes).padStart(2,"0")}:${String(seconds).padStart(2,"0")}`;
}

function startQuestionTimer() {
    if (questionTimer) clearInterval(questionTimer);
    questionRemaining = 20;
    quizTimerEl.textContent = `Temps · ${formatSeconds(questionRemaining)}`;

    questionTimer = setInterval(() => {
        questionRemaining -= 1;
        if (questionRemaining <= 0) {
            questionRemaining = 0;
            clearInterval(questionTimer);
            onTimeUp();
        }
        quizTimerEl.textContent = `Temps · ${formatSeconds(questionRemaining)}`;
    }, 1000);
}

/* Démarrage du rituel */
function startQuiz() {
    currentIndex = 0;
    answers = [];
    currentSelection = null;
    showingExplanation = false;
    examStartTime = Date.now();
    renderQuestion();
}

/* Affichage question */
function renderQuestion() {
    const q = QUIZ_DATA[currentIndex];

    quizIndexEl.textContent = (currentIndex + 1).toString();
    quizQuestionEl.textContent = q.question;
    quizMetaEl.textContent = `Domaine : ${q.domain} · Niveau : Oracle ${q.level}`;
    quizStepEl.textContent = `Étape ${currentIndex + 1} / ${TOTAL_QUESTIONS}`;

    showingExplanation = false;
    quizExplanationEl.classList.add("hidden");
    quizExplanationEl.innerHTML = "";

    q.options.forEach((opt, idx) => {
        const textEl = document.getElementById(`opt-${idx}`);
        if (textEl) textEl.textContent = opt;
    });

    currentSelection = null;
    optionButtons.forEach(btn => {
        btn.classList.remove("selected");
        btn.classList.remove("disabled");
    });
    btnNext.disabled = true;

    btnNext.textContent = (currentIndex === TOTAL_QUESTIONS - 1)
        ? "Valider la dernière réponse"
        : "Valider la réponse";

    startQuestionTimer();
}

/* Sélection option — impossible après explication */
optionButtons.forEach(btn => {
    btn.addEventListener("click", () => {
        if (showingExplanation) return; // verrou visuel & logique

        const idx = parseInt(btn.dataset.index, 10);
        currentSelection = idx;

        optionButtons.forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");
        btnNext.disabled = false;
    });
});

/* Gestion timer arrivé à 0 : question manquée */
function onTimeUp() {
    if (showingExplanation) return;

    const q = QUIZ_DATA[currentIndex];

    let userLetter, userText;
    if (currentSelection === null) {
        userLetter = "—";
        userText = "Aucune réponse (temps écoulé)";
    } else {
        userLetter = LETTERS[currentSelection];
        userText = q.options[currentSelection];
    }

    const correctLetter = LETTERS[q.correct_index];
    const correctText = q.options[q.correct_index];

    const explanationHtml = `
        <div class="quiz-explanation-line ex-user">
            <span class="ex-label">Ta réponse</span>
            <span class="letter">${userLetter}</span>
            <span class="text"> — ${userText}</span>
        </div>
        <div class="quiz-explanation-line ex-correct">
            <span class="ex-label">Réponse attendue</span>
            <span class="letter">${correctLetter}</span>
            <span class="text"> — ${correctText}</span>
        </div>
        ${q.explanation ? `<div class="quiz-explanation-line ex-orion">${q.explanation}</div>` : ""}
    `;

    quizExplanationEl.innerHTML = explanationHtml;
    quizExplanationEl.classList.remove("hidden");

    optionButtons.forEach(btn => btn.classList.add("disabled"));

    showingExplanation = true;
    btnNext.disabled = false;
    btnNext.textContent = (currentIndex === TOTAL_QUESTIONS - 1)
        ? "Terminer le rituel"
        : "Question suivante";
}

/* Bouton suivant :
   - 1er clic => explication + verrou des réponses
   - 2e clic => question suivante */
btnNext.addEventListener("click", () => {
    const q = QUIZ_DATA[currentIndex];

    if (!showingExplanation) {
        if (currentSelection === null) return;

        const userLetter = LETTERS[currentSelection];
        const userText = q.options[currentSelection];
        const correctLetter = LETTERS[q.correct_index];
        const correctText = q.options[q.correct_index];

        const explanationHtml = `
            <div class="quiz-explanation-line ex-user">
                <span class="ex-label">Ta réponse</span>
                <span class="letter">${userLetter}</span>
                <span class="text"> — ${userText}</span>
            </div>
            <div class="quiz-explanation-line ex-correct">
                <span class="ex-label">Réponse attendue</span>
                <span class="letter">${correctLetter}</span>
                <span class="text"> — ${correctText}</span>
            </div>
            ${q.explanation ? `<div class="quiz-explanation-line ex-orion">${q.explanation}</div>` : ""}
        `;

        quizExplanationEl.innerHTML = explanationHtml;
        quizExplanationEl.classList.remove("hidden");

        optionButtons.forEach(btn => btn.classList.add("disabled"));

        showingExplanation = true;

        btnNext.textContent = (currentIndex === TOTAL_QUESTIONS - 1)
            ? "Terminer le rituel"
            : "Question suivante";

    } else {
        // Enregistrement de la réponse (ou absence de réponse si timeout sans choix)
        let choiceIndex, choiceLetter;
        if (currentSelection === null) {
            choiceIndex = -1;
            choiceLetter = "-";
        } else {
            choiceIndex = currentSelection;
            choiceLetter = LETTERS[currentSelection];
        }

        answers.push({
            question_id: q.id,
            choice_index: choiceIndex,
            choice_letter: choiceLetter
        });

        if (currentIndex < TOTAL_QUESTIONS - 1) {
            currentIndex += 1;
            renderQuestion();
        } else {
            endQuiz();
        }
    }
});

/* Fin de rituel + envoi à Telegram -> bot -> Notion */
function endQuiz() {
    if (questionTimer) clearInterval(questionTimer);

    const endTime = Date.now();
    const totalSeconds = Math.round((endTime - examStartTime) / 1000);

    // Construction des réponses enrichies pour le bot
    let correctCount = 0;
    const enrichedAnswers = answers.map(a => {
        const q = QUIZ_DATA.find(qq => qq.id === a.question_id);
        let status = "wrong";

        if (a.choice_index === -1) {
            status = "timeout";
        } else if (q && a.choice_index === q.correct_index) {
            status = "correct";
            correctCount += 1;
        }

        return {
            question_id: a.question_id,
            choice_letter: a.choice_letter,
            status: status
        };
    });

    // Payload pour Telegram.WebApp.sendData (le bot s’en charge ensuite)
    const payload = {
        mode: "exam_v1",
        score: correctCount,
        total: TOTAL_QUESTIONS,
        total_time_seconds: totalSeconds,
        answers: enrichedAnswers
    };

    if (tg && typeof tg.sendData === "function") {
        tg.sendData(JSON.stringify(payload));
    } else {
        console.log("Payload WebApp → bot :", payload);
    }

    // UI de clôture
    quizQuestionEl.textContent =
        "Rituel terminé — les portes Velvet se referment doucement.";
    quizMetaEl.textContent =
        "Tes réponses rejoignent maintenant les registres silencieux de l’oracle.";
    quizExplanationEl.classList.add("hidden");
    quizExplanationEl.innerHTML = "";

    quizTimerEl.textContent = `Temps total · ${formatSeconds(totalSeconds)}`;
    btnNext.disabled = true;
    btnNext.textContent = "Rituel complété";
}
</script>

</body>
</html>
